#!/usr/bin/env python3

# SPDX-FileCopyrightText: The RamenDR authors
# SPDX-License-Identifier: Apache-2.0

import drenv
from drenv import kubectl
from drenv import test

test.start("undeploy", __file__)
args = test.parse_args()
config = test.config

test.info("Deleting '%s' subscription", config["namespace"])
with drenv.kustomization(
    "subscription/kustomization.yaml",
    namespace=config["namespace"],
    repo=config["repo"],
    branch=config["branch"],
) as sub:
    kubectl.delete(
        f"--kustomize={sub}",
        "--ignore-not-found",
        context=test.env["hub"],
        log=test.debug,
    )

test.info("Deleting sample channel")
kubectl.delete(
    f"--kustomize={config['repo']}/channel?ref={config['branch']}",
    "--ignore-not-found",
    context=test.env["hub"],
    log=test.debug,
)

test.info("Application was undeployed successfully")
