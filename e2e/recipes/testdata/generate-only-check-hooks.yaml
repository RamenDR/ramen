# SPDX-FileCopyrightText: The RamenDR authors
# SPDX-License-Identifier: Apache-2.0

---
apiVersion: recipe.ramendr.io/v1alpha1
kind: Recipe
metadata:
  name: disapp-deploy-rbd
  namespace: test-disapp-deploy-rbd
spec:
  groups:
    - name: rg1
      type: resource
      backupRef: rg1
      includedNamespaces:
        - test-disapp-deploy-rbd
      labelSelector:
        matchLabels:
          appname: busybox
  hooks:
    - name: check-hook
      type: check
      namespace: test-disapp-deploy-rbd
      labelSelector:
        matchLabels:
          appname: busybox
      selectResource: deployment
      timeout: 300
      chks:
        - name: check-replicas
          condition: "{$.spec.replicas} == {$.status.readyReplicas}"
        - name: check-available
          condition: "{$.spec.replicas} == {$.status.availableReplicas}"
  workflows:
    - name: backup
      sequence:
        - hook: check-hook/check-replicas
        - hook: check-hook/check-available
        - group: rg1
    - name: restore
      sequence:
        - group: rg1
        - hook: check-hook/check-replicas
        - hook: check-hook/check-available
